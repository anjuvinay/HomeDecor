<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title>Home Decor</title>
    <link rel="stylesheet" href="assets/css/maind134.css?v=3.4">
     <link href="/assets/css/userstyle.css" rel="stylesheet" type="text/css" />
     <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

     <style>
   
        body, html {
    overflow-x: hidden;
}

     </style>
</head>

<body >
    <header class="header-area header-style-5">
        
        <div class="header-bottom header-bottom-bg-color sticky-bar">
            <div class="container" style="overflow: hidden;">
                <div class="header-wrap header-space-between position-relative">
                    <div class="logo" style="display: flex;">&nbsp;&nbsp;
                        <a href="/"><img src="/assets/images/blue-house-icon-isolated.jpg" alt="logo" style="height: 2rem; width: 2rem;"></a>&nbsp;&nbsp;
                       <p style="font-weight: bold;">Home Decor</p>
                    </div>
                    <div class="header-nav d-none d-lg-flex">
                       
                        <div class="main-menu main-menu-padding-1 main-menu-lh-2 d-none d-lg-block">
                            <nav>
                                <ul>
                                    <li><a  href="/">Home </a>
                                       
                                    </li>
                                   
                                    <li><a href="/shop" >Shop </a>
                                       
                                    </li>
                                  
                                    <li>
                                        <a href="/cart">cart</a>
                                    </li>
                                     <li>
                                        <a href="/userAccount">profile</a>
                                    </li>
                                    <li><a href="/wishlist">Wishlist </a>
                                       
                                    </li>
                                    <li><a href="/wallet">wallet </a>
                                       
                                    </li>
                                    
                                </ul>
                            </nav>
                        </div>
                    </div>
                   
                    <!-- <p class="mobile-promotion">Happy <span class="text-brand">Mother's Day</span>. Big Sale Up to 40%</p> -->
                    <div class="header-action-right d-block d-lg-none">
                       
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="mobile-header-active mobile-header-wrapper-style">
        <div class="mobile-header-wrapper-inner">
            <div class="mobile-header-top">
                <div class="mobile-header-logo">
                    <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                </div>
                <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                    <button class="close-style search-close">
                        <i class="icon-top"></i>
                        <i class="icon-bottom"></i>
                    </button>
                </div>
            </div>
            <div class="mobile-header-content-area">
                <div class="mobile-menu-wrap mobile-header-border">
                 
                    <!-- mobile menu start -->
                    <nav>
                        <ul class="mobile-menu">
                            <li><a  href="/">Home </a>
                                <li><a href="/shop" class="active">Shop </a>
                           
                            <li>
                                <a href="/about">About</a>
                            </li>
                            <li><a href="/contact">Contact </a>
                               
                            </li>
                            <li><a href="/userAccount">Account </a>
                               
                            </li>
                        </ul>
                    </nav>
                    <!-- mobile menu end -->
                </div>
              
            </div>
        </div>
    </div>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="/" rel="nofollow">Home</a>
                    <span></span> Account
                </div>
            </div>
        </div>
        <section class="pt-70 pb-170">
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 m-auto">
                        <div class="row" style="display: flex;">
                            <div class="col-md-4">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link1 active" id="dashboard-tab" data-bs-toggle="tab"
                                                href="#dashboard" role="tab" aria-controls="dashboard"
                                                aria-selected="false"><i
                                                    class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link1" id="orders-tab"  href=""
                                                role="tab" aria-controls="orders" aria-selected="false"><i
                                                    class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link1" id="track-orders-tab" data-bs-toggle="tab"
                                                href="#track-orders" role="tab" aria-controls="track-orders"
                                                aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>My
                                                Wallet</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link1" href="/addressForm"><i
                                                    class="fi-rs-marker mr-10"></i>My Address</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link1" 
                                                href="#account-detail" role="tab" aria-controls="account-detail"
                                                aria-selected="true"><i class="fi-rs-user mr-10"></i>Edit Account
                                                details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link1" id="referalCode-tab" data-bs-toggle="tab"
                                                href="#referalCode" role="tab" aria-controls="referalCode"
                                                aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>Referal Code
                                                </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link1" href="/logout"><i
                                                    class="fi-rs-sign-out mr-10"></i>Logout</a>
                                        </li>

                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="tab-content dashboard-content">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                        aria-labelledby="dashboard-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Hello <%=user.name%>! </h5>
                                            </div>
                                            <div class="card-body">
                                                <table>
                                                    <tr>
                                                        <td>Name:</td>
                                                        <td>
                                                            <%=user.name%>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Phone:</td>
                                                        <td>
                                                            <%=user.mobile%>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Email:</td>
                                                        <td>
                                                            <%=user.email%>
                                                        </td>
                                                    </tr>
                                                    <% if (addresses && addresses.length > 0) { %>
                                                        <tr>
                                                            <td>Address:</td>
                                                            <td>
                                                                <%=addresses[0].city%>, <%=addresses[0].state%>,
                                                                <%=addresses[0].country%>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Pincode:</td>
                                                            <td>
                                                                <%=addresses[0].pincode%>
                                                            </td>
                                                        </tr>
                                                    <% } %>
                                                </table>
                                

                                            </div>
                                        </div>
                                    </div>
                                    
                                        <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Your Orders</h5>
                                                </div>
                                                <!-- userAccount.ejs -->
    
    
    
                                                <div class="card-body">
                                                    <div class="table-responsive">
                                                        <table class="table" id="ordersTable" > 
                                                            <thead>
                                                                <tr>
                                                                    <th>Order</th>
                                                                    <th>Date</th>
                                                                    <th>Status</th>
                                                                    <th>Total</th>
                                                                    <th>Payment</th>
                                                                    <th>Actions</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <%for(i=0;i<orders.length;i++){%>
    
                                                                    <tr>
                                                                        <td>ORD<%=orders[i].orderId%>
                                                                        </td>
                                                                        <td>
                                                                            <%= new Intl.DateTimeFormat('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' }).format(new Date(orders[i].orderDate)) %>
                                                                          
                                                                        </td>
                                                                        <%if(orders[i].orderstatus=='Cancelled' ||
                                                                            orders[i].orderstatus=='Returned' ){%>
                                                                            <td class="text-danger">
                                                                                <%=orders[i].orderstatus%>
                                                                            </td>
                                                                            <%}else{%>
                                                                                <td class="text-success">
                                                                                    <%=orders[i].orderstatus%>
                                                                                </td>
                                                                                <%}%>
                                                                                    <td>
                                                                                        <%=orders[i].totalAmount%>
                                                                                    </td>
                                                                                    <td>
                                                                                        <%=orders[i].paymentMethod%>
                                                                                    </td>
                                                                                    <td><a href="/orderDetails?id=<%=orders[i]._id%>"
                                                                                            class="btn-small d-block">View Order</a>
                                                                                    </td>
                                                                    </tr>
                                                                    <%}%>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                       
                                        <div class="tab-pane fade" id="track-orders" role="tabpanel"
                                        aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Wallet Balance</h5>
                                            </div>
                                            <div class="card-body contact-from-area" style="height: 10em;">
                                                <br>
                                                <h4> ₹ <%=user.wallet.toFixed(2)%>
                                                </h4>
                                                
                                            </div>
                                        </div>
                                    </div>
                                   
                                        <!-- ........ -->
                                         <br>
                                         <div class="tab-pane fade" id="address" role="tabpanel"
                                        aria-labelledby="address-tab">
                                        <a href="/addressForm"><button class="btn btn-md rounded font-sm hover-up">+ Add
                                                address</button></a><br><br>
                                        <div class="row">
                                            <%for(i=0;i<addresses.length;i++){%>&nbsp;&nbsp;&nbsp;&nbsp;
                                                <div class="col-lg-6 mb-4">
                                                    <div class="card mb-3 mb-lg-0">
                                                        <div class="card-header">
                                                            <h5 class="mb-0">Billing Address <%= i + 1 %></h5>
                                                        </div>
                                                        <div class="card-body">
                                                            <address class="text-center-custom">
                                                                <%=addresses[i].fname%>
                                                                    <%=addresses[i].lname%><br>
                                                                        <%=addresses[i].housename%><br>
                                                                            <%=addresses[i].city%> <br>
                                                                                <%=addresses[i].state%> <br>
                                                                                    <%=addresses[i].pincode%> <br>
                                                                                        <%=addresses[i].phone%>
                                                            </address>
                                                            <button style="background-color: rgb(174, 201, 198); border: 1px;margin-left: 2rem;">
                                                                <a href="/editAddressForm?addressId=<%=addresses[i]._id%>"
                                                                    class="btn-small">Edit</a></button>&nbsp;&nbsp;&nbsp;
                                                            <button style="background-color: rgb(174, 201, 198); border: 1px;">
                                                                <a href="/deleteAddress?addressId=<%=addresses[i]._id%>"
                                                                    class="btn-small">Delete</a></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            <%}%>
                                        </div>
                                    </div>
                                    <br>

                                        <!-- ........... -->
                                     
                                    </div>
                                    <div class="tab-pane fade" id="account-detail" role="tabpanel"
                                        aria-labelledby="account-detail-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Account Details</h5>
                                            </div>
                                            <div class="card-body">

                                                <form method="post" action="/updateUserDetails" name="enq" onsubmit="return validateForm()">
                                                    <div class="row" style="display: flexbox; margin: auto; margin-left: 7%; margin-bottom: 2%; margin-top: 2%;">
                                                        <div class="form-group col-md-12">
                                                            <label>First Name <span class="required">*</span></label>
                                                            <input required="" class="form-control square" name="name" value="<%=user.name%>" type="text">
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Email Address <span class="required">*</span></label>
                                                            <input required="" class="form-control square" name="nemail" type="email" value="<%=user.email%>" readonly>
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Mobile <span class="required">*</span></label>
                                                            <input required="" class="form-control square" name="mobile" type="text" pattern="\d{10}" title="Please enter a 10-digit mobile number" value="<%=user.mobile%>">
                                                        </div>
                                                        <div class="col-md-12">
                                                            <button type="submit" class="btn btn-fill-out submit" name="submit" value="Submit">Update Details</button>
                                                        </div>
                                                    </div>
                                                </form>
                                                <script>
                                                    function validateForm() {
                                                        var usernameField = document.forms["enq"]["name"];
                                                        var mobileNumberField = document.forms["enq"]["mobile"];
                                                        
                                                        var username = usernameField.value.trim();
                                                        var mobileNumber = mobileNumberField.value.trim();
                                                
                                                        // Update form fields with trimmed values
                                                        usernameField.value = username;
                                                        mobileNumberField.value = mobileNumber;
                                                
                                                        // Name validation
                                                        var nameRegex = /^[a-zA-Z\s]+$/;
                                                        if (username === '' || !nameRegex.test(username)) {
                                                            Swal.fire({
                                                                icon: 'error',
                                                                title: 'Invalid Name',
                                                                text: 'Please enter a valid name without numbers or special characters.',
                                                                confirmButtonText: 'Okay'
                                                            });
                                                            return false;
                                                        }
                                                
                                                        var mobileNumberRegex = /^[1-9]\d{9}$/;
                                                        if (!mobileNumberRegex.test(mobileNumber)) {
                                                        Swal.fire({
                                                          icon: 'error',
                                                          title: 'Invalid Mobile Number',
                                                          text: 'Please enter a valid 10-digit mobile number that does not start with 0.',
                                                          confirmButtonText: 'Okay'
                                                              });
                                                          return false;
                                                                }

                                                        // Check if mobile number is not all the same digits
                                                        var allSameDigits = /^(.)\1+$/.test(mobileNumber);
                                                        if (allSameDigits) {
                                                             Swal.fire({
                                                                icon: 'error',
                                                                title: 'Invalid Mobile Number',
                                                                text: 'Mobile number cannot be made up of all the same digits.',
                                                                confirmButtonText: 'Okay'
                                                                  });
                                                                return false;
                                                         }
                                                
                                                        return true;
                                                    }
                                                </script>
                                                
                                                
                                                <!-- <script>
                                                    function validateForm() {
                                                        var username = document.forms["enq"]["name"].value.trim();
                                                        var mobileNumber = document.forms["enq"]["mobile"].value.trim();
                                                
                                                        if (username === '') {
                                                            alert('Username cannot be empty');
                                                            return false;
                                                        }
                                                
                                                        if (!/^\d{10}$/.test(mobileNumber)) {
                                                            alert('Please enter a valid 10-digit mobile number');
                                                            return false;
                                                        }
                                                
                                                        return true;
                                                    }
                                                </script> -->
                                                
                                                

                                            </div>

                                            <div class="card-header">
                                                <h5>Edit Password</h5>
                                            </div>
                                            <div class="card-body">


                                                <!-- <form method="post" action="/updatePassword" name="enq"> -->
                                                <div class="row" style="display: grid; margin: auto; margin-bottom: 2%; margin-top: 2%;">
                                                    <div style="display: flex; margin-left: 2%;">
                                                    <div class="form-group col-md-12">
                                                       
                                                        <label>Current Password <span class="required">*</span></label>
                                                        <input required="" class="form-control square"
                                                            name="currentPassword" id="currentPassword" type="password">
                                                            <span id="showMessage1" class="text-danger"></span>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>New Password <span class="required">*</span></label>
                                                        <input required="" class="form-control square" name="npassword"
                                                            id="npassword" type="password">
                                                            <span id="showMessage2" class="text-danger"></span>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label>Confirm Password <span class="required">*</span></label>
                                                        <input required="" class="form-control square" name="cpassword"
                                                            id="cpassword" type="password">
                                                    </div>
                                                </div>
                                               
                                                    <div class="col-md-12" style="margin-left: 7%;">
                                                        <button type="button" class="btn btn-fill-out submit"
                                                            onclick="setPassword()" name="submit" value="Submit">Change
                                                            Password</button>
                                                    </div>
                                                
                                                </div>
                                                <!-- </form> -->
                                                <script>
                                                    var currentPassword = document.getElementById('currentPassword');
                                                    var npassword = document.getElementById('npassword');
                                                    var cpassword = document.getElementById('cpassword');
                                                    var showMessage1 = document.getElementById('showMessage1');
                                                    var showMessage2 = document.getElementById('showMessage2');
                                                
                                                    function setPassword() {
                                                        // Reset error messages
                                                        showMessage1.textContent = '';
                                                        showMessage2.textContent = '';
                                                
                                                        // Client-side validation
                                                        if (!currentPassword.value) {
                                                            showMessage1.textContent = 'Current Password is required.';
                                                            return;
                                                        }
                                                
                                                        if (!npassword.value) {
                                                            showMessage2.textContent = 'New Password is required.';
                                                            return;
                                                        } else if (!/^(?=.*\d)(?=.*[a-zA-Z]).{8,}$/.test(npassword.value)) {
                                                            showMessage2.textContent = 'New Password must contain at least one digit, one letter, and be at least 8 characters long.';
                                                            return;
                                                        }
                                                
                                                        if (!cpassword.value) {
                                                            showMessage2.textContent = 'Confirm Password is required.';
                                                            return;
                                                        } else if (!/^(?=.*\d)(?=.*[a-zA-Z]).{8,}$/.test(cpassword.value)) {
                                                            showMessage2.textContent = 'Confirm Password must contain at least one digit, one letter, and be at least 8 characters long.';
                                                            return;
                                                        }
                                                
                                                        if (npassword.value !== cpassword.value) {
                                                            showMessage2.textContent = 'New Password and Confirm Password do not match.';
                                                            return;
                                                        }
                                                
                                                        // Fetch API to send data to the server
                                                        fetch('/updatePassword', {
                                                            method: 'POST',
                                                            headers: {
                                                                'Content-Type': 'application/json',
                                                            },
                                                            body: JSON.stringify({
                                                                currentPassword: currentPassword.value,
                                                                npassword: npassword.value,
                                                                cpassword: cpassword.value
                                                            }),
                                                        })
                                                        .then(response => response.json())
                                                        .then(data => {
                                                            if (data.message1) {
                                                                showMessage1.textContent = data.message1;
                                                            } else if (data.message2) {
                                                                showMessage1.style.display = 'none';
                                                                showMessage2.textContent = data.message2;
                                                            } else if (data.message3) {
                                                                // Redirect to '/userAccount' when the password change is successful
                                                                window.location.href = '/userAccount';
                                                            }
                                                        })
                                                        .catch(err => {
                                                            console.log(err.message);
                                                        });
                                                    }
                                                </script>
                                                
                                            </div>
                                        </div>

                                    </div>

                                    <div class="tab-pane fade" id="referalCode" role="tabpanel"
                                    aria-labelledby="referalCode-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Referal code</h5>
                                        </div>
                                        <div class="card-body contact-from-area" style="height: 10em;">
                                            <br>
                                            
                                            <h4><%=user.referralCode%></h4>
                                            
                                        </div>
                                    </div>
                                </div>
                                  
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
          

        </section>
    </main>
    <%- include('footer') %>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    
    <script>
        $(document).ready(function () {
            $('#ordersTable').DataTable();
        });
    </script>
  
   
    <!-- Vendor JS-->
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="assets/js/plugins/slick.js"></script>
    <script src="assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="assets/js/plugins/wow.js"></script>
    <script src="assets/js/plugins/jquery-ui.js"></script>
    <script src="assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="assets/js/plugins/magnific-popup.js"></script>
    <script src="assets/js/plugins/select2.min.js"></script>
    <script src="assets/js/plugins/waypoints.js"></script>
    <script src="assets/js/plugins/counterup.js"></script>
    <script src="assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="assets/js/plugins/images-loaded.js"></script>
    <script src="assets/js/plugins/isotope.js"></script>
    <script src="assets/js/plugins/scrollup.js"></script>
    <script src="assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="assets/js/plugins/jquery.theia.sticky.js"></script>
    <!-- Template  JS -->
    <script src="assets/js/maind134.js?v=3.4"></script>
</body>


</html>